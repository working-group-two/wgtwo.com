<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">VoWifi leaking IMSI | Case Studies Redesign (#174)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.wgtwo.com/img/wgtwo-logo.png"><meta data-rh="true" name="twitter:image" content="https://www.wgtwo.com/img/wgtwo-logo.png"><meta data-rh="true" property="og:url" content="https://www.wgtwo.com/blog/vowifi-imsi-leak/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="og:description" content="We help mobile operators innovate at scale, reduce cost and dive into new revenue streams - by building a mobile core network from the ground up and delivering it as-a-service."><meta data-rh="true" name="og:image" content="/img/wgtwo-logo.png"><meta data-rh="true" name="keywords" content="mvne, private network, epc, 5G core, mvno, IMS core, mobile core, evolved packet core epc, mvno core, core as a service&#x27;"><meta data-rh="true" property="og:title" content="VoWifi leaking IMSI | Case Studies Redesign (#174)"><meta data-rh="true" name="description" content="4G offers more services than the earlier generation such as 3G and 2G. One of"><meta data-rh="true" property="og:description" content="4G offers more services than the earlier generation such as 3G and 2G. One of"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-03-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://www.linkedin.com/in/rskjetlein/"><meta data-rh="true" property="article:tag" content="telco,4G,ePDG,VoWifi,networking,security"><link data-rh="true" rel="icon" href="/img/favicons/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.wgtwo.com/blog/vowifi-imsi-leak/"><link data-rh="true" rel="alternate" href="https://www.wgtwo.com/blog/vowifi-imsi-leak/" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.wgtwo.com/jp/blog/vowifi-imsi-leak/" hreflang="jp"><link data-rh="true" rel="alternate" href="https://www.wgtwo.com/blog/vowifi-imsi-leak/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Case Studies Redesign (#174) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Case Studies Redesign (#174) Atom Feed">



<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-N4969FH",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><link rel="stylesheet" href="/assets/css/styles.709939c6.css">
<link rel="preload" href="/assets/js/runtime~main.417c5b9c.js" as="script">
<link rel="preload" href="/assets/js/main.9a597f30.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="wgtwo Logo" class="themedImage_ToTc themedImage--light_HNdA" height="32px" width="191px"><img src="/img/logo_white.svg" alt="wgtwo Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="32px" width="191px"></div></a><a class="navbar__item navbar__link" target="_self" href="/technology/">Technology</a><a class="navbar__item navbar__link" target="_self" href="/product-ecosystem/">Product Ecosystem</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/showcase/">Showcase</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/showcase/vimla/">Vimla</a></li><li><a class="dropdown__link" href="/showcase/ckh-iod/">CKH IOD</a></li><li><a class="dropdown__link" href="/showcase/mki/">MKI</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/careers/">Join the Team üéâ</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link sign-up" href="/contact/">Talk to us</a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 blogBackground_WB8r"><div class="container margin-vert--lg"><div class="row"><main class="col col8_DrcQ colOffset1_fYNX singleBlogPageView_LeVK" itemscope="" itemtype="http://schema.org/Blog"><article class="articleContainer_Rf03" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header class="articleCardHeader_doJu"><h1 class="title_xvU1" itemprop="headline">VoWifi leaking IMSI</h1><div class="container_iJTo margin-vert--md"><div class="dateContainer_S5xq"><time datetime="2020-03-30T00:00:00.000Z" itemprop="datePublished">March 30, 2020</time> ¬∑ <!-- -->6 min read</div><div class="iconsContainer_WcqX"><button class="button_jnFd"><svg height="500" width="500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500" class="icon_K6Vf"><path d="M50 0C22.3 0 0 22.3 0 50v400c0 27.7 22.3 50 50 50h400c27.7 0 50-22.3 50-50V50c0-27.7-22.3-50-50-50H50zm89.906 105.781c19.182 0 34.719 15.537 34.719 34.719 0 19.182-15.537 34.75-34.719 34.75-19.182 0-34.719-15.568-34.719-34.75 0-19.182 15.537-34.719 34.72-34.719zm181.875 90.438c3.922.014 7.925.199 13.313.531 26.184 1.615 55.36 22.08 56.219 70.031.706 39.493.5 102.081.5 125.125H332.28c0-23.574.25-72.274.25-106.719 0-15.672-7.035-36.75-32.094-36.75-27.597 0-34.312 25.645-34.312 36.75 0 33.074-.281 85.752-.281 106.72h-59.188c0-35.345.375-156.654.375-190.907 30.568 0 45.191-.063 56.375-.063 0 11.218-.094 18.722-.094 26.907 9.337-18.852 34.832-30.655 45.75-31.219 4.98-.257 8.797-.42 12.72-.406zm-211.594 5.531h59.344v190.063h-59.344V201.75z" style="fill-opacity:1;fill-rule:nonzero"></path></svg></button><button class="button_jnFd"><svg xmlns="http://www.w3.org/2000/svg" height="56.693" width="56.693" viewBox="0 0 56.693 56.693" xml:space="preserve" class="icon_K6Vf"><rect width="100%" height="100%" fill="none"></rect><g class="currentLayer"><title>Layer 1</title><path d="M56.237 11.546a22.859 22.859 0 0 1-6.598 1.809 11.509 11.509 0 0 0 5.051-6.357 22.997 22.997 0 0 1-7.295 2.79 11.473 11.473 0 0 0-8.385-3.629c-6.344 0-11.488 5.144-11.488 11.489 0 .899.101 1.775.298 2.618-9.548-.48-18.014-5.053-23.68-12.004a11.43 11.43 0 0 0-1.555 5.777c0 3.985 2.027 7.502 5.11 9.562a11.456 11.456 0 0 1-5.204-1.438v.145c0 5.565 3.96 10.208 9.215 11.265a11.55 11.55 0 0 1-5.189.195c1.463 4.564 5.705 7.887 10.732 7.979A23.047 23.047 0 0 1 2.98 46.665c-.926 0-1.841-.055-2.74-.161a32.51 32.51 0 0 0 17.61 5.161c21.132 0 32.687-17.505 32.687-32.686 0-.498-.01-.995-.032-1.488a23.268 23.268 0 0 0 5.731-5.945z" class="selected"></path></g></svg></button><button class="button_jnFd"><svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256" class="icon_K6Vf"><rect width="100%" height="100%" fill="none"></rect><g class="currentLayer"><title>Layer 1</title><path fill="none" d="M0 0h256v256H0z"></path><path d="M255.429 115.27a33.99 33.99 0 0 0-56.19-25.705c-17.844-9.453-39.088-15.189-61.287-16.464l5.523-33.14 23.156 3.612a25.705 25.705 0 1 0 2.655-16.783l-31.547-4.886a8.497 8.497 0 0 0-9.666 7.01l-7.329 44.081c-23.155.956-45.46 6.692-64.049 16.57a33.99 33.99 0 0 0-45.249 50.666 65.218 65.218 0 0 0-2.443 17.526c0 23.262 12.746 45.037 36.008 61.076s51.728 23.899 82.956 23.899 60.65-8.498 82.957-23.9 36.007-37.813 36.007-61.075a63.837 63.837 0 0 0-2.443-17.42 34.415 34.415 0 0 0 10.94-25.067zM68.485 145.011a16.995 16.995 0 1 1 16.995 16.995 16.995 16.995 0 0 1-16.995-16.995zm98.464 54.277a85.08 85.08 0 0 1-77.964 0 8.497 8.497 0 0 1 7.754-15.082 68.192 68.192 0 0 0 62.456 0 8.497 8.497 0 0 1 7.754 15.082zm3.505-37.282a16.995 16.995 0 1 1 16.995-16.995 16.995 16.995 0 0 1-16.995 16.995z"></path></g></svg></button><span class="spacer_N6vp">|</span><button class="button_jnFd"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="icon_K6Vf iconLink_fFIC"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></button></div></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/rskjetlein/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="/img/author-photos/rs.jpg" alt="Roger Skjetlein"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/rskjetlein/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Roger Skjetlein</span></a></div><small class="avatar__subtitle" itemprop="description" title="Senior Software Engineer">Senior Software Engineer</small></div></div></div></div></header><div id="post-content" class="markdown articleContent_wrOu" itemprop="articleBody"><p>4G offers more services than the earlier generation such as 3G and 2G. One of
the services has really have gained traction later years is VoLTE (Voice
over LTE) and VoWifi (Voice over Wifi) that we will go more in dept regarding security.</p><p>VoWifi is beneficial in terms being able to use any Wifi connection offering public
internet access thus extending and improving the coverage and connectivity.
Think of it as building our own cellular network, but
using commodity wifi components instead and avoiding the strict regulation and
licensing of spectrum.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-imsi">What is IMSI<a class="hash-link" href="#what-is-imsi" title="Direct link to heading">‚Äã</a></h2><p><em>The international mobile subscriber identity (IMSI) is a number that uniquely
identifies every user of a cellular network. It is stored as a 64-bit field
and is sent by the mobile device to the network. It is also used for acquiring
other details of the mobile in the home location register (HLR) or as locally
copied in the visitor location register. To prevent eavesdroppers from
identifying and tracking the subscriber on the radio interface, the IMSI is sent
as rarely as possible and a randomly-generated TMSI is sent instead.</em></p><ul><li><a href="https://en.wikipedia.org/wiki/International_mobile_subscriber_identity" target="_blank" rel="noopener noreferrer">IMSI article</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-implications">Security implications<a class="hash-link" href="#security-implications" title="Direct link to heading">‚Äã</a></h3><p>The IMSI is a secret identifier stored on the sim and can be exploited in many
ways once known. It is bound to the sim, so changing UE will not help.</p><p>Examples:</p><ul><li>Locating user (UE)</li><li>Intercepting calls</li><li>Intercepting SMS (stealing two factor pin eg.)</li><li>..and more</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-vowifi-works">How VoWifi works<a class="hash-link" href="#how-vowifi-works" title="Direct link to heading">‚Äã</a></h2><p>When your phone is connected to datanetwork and with volte and vowifi enabled
the device (UE) establish sip session directly to packetgateway via 4g, and via
public internet to epdg (evolved packet data gateway) which is in essence a
ipsec (ikev2) termination using SIM-AKA to authenticate UE. The ipsec comes into
play since epdg is exposed publicly.</p><p>We won&#x27;t go further in depth for volte and vowifi since there are already
excellent articles about the matter:</p><ul><li><a href="https://en.wikipedia.org/wiki/Voice_over_WLAN" target="_blank" rel="noopener noreferrer">Voice over WLAN</a></li><li><a href="https://en.wikipedia.org/wiki/Voice_over_LTE" target="_blank" rel="noopener noreferrer">Voice over LTE</a></li></ul><p><img loading="lazy" alt="VoWifi topology" src="/assets/images/vowifi-ed900be33ec8a7b58034fb2e5a8a8dca.jpg" width="672" height="280" class="img_ev3q"></p><p>To enable VoWifi on your device, please refer to your device manufacturer website:</p><ul><li><a href="https://support.google.com/phoneapp/answer/2811843?hl=en" target="_blank" rel="noopener noreferrer">Android</a></li><li><a href="https://support.apple.com/en-in/HT203032" target="_blank" rel="noopener noreferrer">Apple</a></li></ul><p>Also check on your operator website if VoWifi is supported in your region. Please note that VoWifi is usually blocked when roaming.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="epdg-exposed-on-the-public-internet">EPDG exposed on the public internet<a class="hash-link" href="#epdg-exposed-on-the-public-internet" title="Direct link to heading">‚Äã</a></h2><p>The Evolved Packet Data Gateway needs to be publicly available on the internet
since UE needs to access it from an arbitrary no-trusted connection. The ipsec
will secure and encrypt both the data and maintain the integrity of the
connection throughout the session.</p><p>The UE finds the epdg termination point by looking dns records partly following
a convention decided by 3gpp and typically looks like this in DNS:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">epdg.epc.mnc999.mcc999.pub.3gppnetwork.org. 3488 IN A 1.2.3.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">epdg.epc.mnc999.mcc999.pub.3gppnetwork.org. 3488 IN A 5.6.7.8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the DNS records we recognize the network operator (MNC) and the
country code (MCC).</p><p>The DNS records are registered under a delegated domain owned by GSMA and
usually are redelegated to operator under their own umbrella, like the example
mnc999.mcc999.pub.3gppnetwork.org.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem">The problem<a class="hash-link" href="#the-problem" title="Direct link to heading">‚Äã</a></h2><p>When UE establish session to epdg it uses a vpn, a ipsec relationship using
IKEv2 for authentication, encryption and integrity.</p><p>So far the implementation works as intended and provides good security through
encryption and security.</p><p>The problem is not the VoWifi per see, by rather how ipsec establish the
session. When UE connects to the epdg, it acts as a initiator and the epdg is
inherently passive since it cannot know where from (ip) the UE will come from.</p><p><img loading="lazy" alt="sim-aka flow" src="/assets/images/sim-aka-a216f5fd634021b704462a689f2df6ae.png" width="464" height="450" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="eap-aka-exposes-identity">EAP-AKA exposes identity<a class="hash-link" href="#eap-aka-exposes-identity" title="Direct link to heading">‚Äã</a></h3><p>Vowifi as mentioned earlier utilises an encryption protocol based on the widely
adopted Extensible Authentication Protocol. EAP itself is just a protocol and
does not define the contents of the data or how exact the data exchanges look
like. EAP-AKA unfortunately exposes the unencrypted user identity during
the authentication session and in this case the user identity is equal to the
imsi.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a class="hash-link" href="#solution" title="Direct link to heading">‚Äã</a></h4><p>This is the hardest problem to solve since it needs a security layer or settings
that comes before ipsec starts to connect.</p><p>The proposed solutions</p><ul><li>Force the use of conservative peer for eap-aka/sim
and use pseudonym identity (tmsi) to avoid exposing imsi.</li><li>Enable EAP-TTLS in addition to EAP-AKA/SIM</li><li>Only connect trusted/encrypted AP&#x27;s</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fake-ipsec-termination-exposes-identity">Fake Ipsec termination exposes identity<a class="hash-link" href="#fake-ipsec-termination-exposes-identity" title="Direct link to heading">‚Äã</a></h3><p>By impersonating a epdg by redirecting all dns requests for any
<code>pub.3gppnetwork.org.</code> to our own fake ipsec termination providing just enough
to catch the imsi.</p><p>A raspberry pie can easily be setup to constantly scan for open wifi networks,
then impersonating the ssid in hope of lure ue&#x27;s to connect. Any UE set to use
VoWiFi connecting to the fake access point will give away their imsi.</p><p>A wifi ssid scan example of what we can automate. In this case the Isfjell-Guest
would have been picked to catch imsi since its open and unencrypted:</p><p><img loading="lazy" alt="wifi-ssid" src="/assets/images/wlan-ssid-8239810014d356e06b17543cf45951d2.png" width="474" height="109" class="img_ev3q"></p><p>Snippet from the ipsec termination, UE (iPhone 8) exposes imsi several times:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[ENC] parsed IKE_AUTH request 2 [ EAP/RES/AKA ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] &#x27;09999994511******@wlan.mnc999.mcc999.3gppnetwork.org&#x27; is not a reauth identity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] &#x27;09999994511******@wlan.mnc999.mcc999.3gppnetwork.org&#x27; is not a pseudonym</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] received identity &#x27;09999994511******@wlan.mnc999.mcc999.3gppnetwork.org&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] no EAP key found for 09999994511******@wlan.mnc999.mcc999.3gppnetwork.org to authenticate with AKA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[LIB] tried 0 SIM providers, but none had a quintuplet for &#x27;09999994511******@wlan.mnc999.mcc999.3gppnetwork.org&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] failed to map pseudonym/reauth identity &#x27;09999994511******@wlan.mnc999.mcc999.3gppnetwork.org&#x27;, fallback to permanent identity request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[ENC] generating IKE_AUTH response 2 [ EAP/REQ/AKA ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[NET] sending packet: from 192.168.17.1[500] to 192.168.17.24[500] (92 bytes)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[NET] received packet: from 192.168.17.24[500] to 192.168.17.1[500] (140 bytes)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[ENC] parsed IKE_AUTH request 3 [ EAP/RES/AKA ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[IKE] received identity &#x27;09999994511******@wlan.mnc999.mcc999.3gppnetwork.org&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[IKE] no EAP key found for 09999994511******@wlan.mnc999.mcc999.3gppnetwork.org to authenticate with AKA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[LIB] tried 0 SIM providers, but none had a quintuplet for &#x27;09999994511******@wlan.mnc999.mcc999.3gppnetwork.org&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[IKE] EAP method EAP_AKA failed for peer 09999994511******@nai.epc.mnc999.mcc999.3gppnetwork.org</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[ENC] generating IKE_AUTH response 3 [ EAP/FAIL ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="solution-1">Solution<a class="hash-link" href="#solution-1" title="Direct link to heading">‚Äã</a></h4><p>Ipsec clients (UE) are able to verify the identity of the epdg by requesting
and validating a machine certificate proving it is the actual service belonging
to the requested dns address. This means when the client connects, the server
has to provide a valid certificate containing the dns names and signed by a
trusted CA.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="raspberry-pi-4">Raspberry PI 4<a class="hash-link" href="#raspberry-pi-4" title="Direct link to heading">‚Äã</a></h2><p>The specific physical setup used for testing. Older PI&#x27;s should work just fine and also
other platforms that can run dnsmasq, tshark and strongswan for ipsec with
support for eap-aka/sim.</p><p><img loading="lazy" alt="rpi4 and battery" src="/assets/images/rpi4-batt-331b622857ead4ba1f8081397efe866f.jpg" width="640" height="480" class="img_ev3q"></p><p><em>white box is the rpi4 in a original casing and gray box is a battery bank</em></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/telco/">telco</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/4-g/">4G</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/e-pdg/">ePDG</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/vo-wifi/">VoWifi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/networking/">networking</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/security/">security</a></li></ul></div><div class="col sharingSection_o4gn col--3"><button aria-haspopup="true" aria-expanded="false" type="button" class="szh-menu-button sharingButton__GCX"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sharingIcon_aNi7"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg></button><div class="szh-menu-container szh-menu-container--itemTransition menuContainer_Dr6x" style="position:relative"></div></div><div class="col margin-top--sm"><a href="https://github.com/working-group-two/wgtwo.com/edit/main/blog/../blog/2020-03-30-catch-imsi-from-vowifi-session.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/choosing-erlang-formatter/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Choosing an Erlang formatter</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/extending-k8s/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Extending Kubernetes for our needs</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-imsi" class="table-of-contents__link toc-highlight">What is IMSI</a><ul><li><a href="#security-implications" class="table-of-contents__link toc-highlight">Security implications</a></li></ul></li><li><a href="#how-vowifi-works" class="table-of-contents__link toc-highlight">How VoWifi works</a></li><li><a href="#epdg-exposed-on-the-public-internet" class="table-of-contents__link toc-highlight">EPDG exposed on the public internet</a></li><li><a href="#the-problem" class="table-of-contents__link toc-highlight">The problem</a><ul><li><a href="#eap-aka-exposes-identity" class="table-of-contents__link toc-highlight">EAP-AKA exposes identity</a></li><li><a href="#fake-ipsec-termination-exposes-identity" class="table-of-contents__link toc-highlight">Fake Ipsec termination exposes identity</a></li></ul></li><li><a href="#raspberry-pi-4" class="table-of-contents__link toc-highlight">Raspberry PI 4</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.wgtwo.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://console.wgtwo.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Console Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/implementation/">Implementation</a></li><li class="footer__item"><a href="https://support.wgtwo.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Customer Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/privacy/">Privacy Notice</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/about/introduction/">About</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/case-studies/mvnx/">Case Studies</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/team/">Team</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/terms-of-use/">Terms of Use</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/careers/">Careers</a></li><li class="footer__item"><a href="https://www.wgtwo.com/jp" target="_blank" rel="noopener noreferrer" class="footer__link-item">wgtwo.com/jp ÂêàÂêå‰ºöÁ§æ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Security</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/security/">Security Overview</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/technology/security-whitepaper/">Security Whitepaper</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/security/responsible-disclosure/">Responsible Disclosure</a></li><li class="footer__item"><a href="https://trust.wgtwo.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trust Report<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/about/media-and-analysts/">Media &amp; Analysts</a></li><li class="footer__item"><a href="https://twitter.com/workinggrouptwo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/working-group-two" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://linkedin.com/company/wgtwo" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/contact/">Contact Us</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/"><img src="/img/logo_white.svg" alt="wgtwo Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="191px" height="32px"><img src="/img/logo_white.svg" alt="wgtwo Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="191px" height="32px"></a></div><div class="footer__copyright">¬© 2023 Working Group Two AS</div></div></div></footer></div>
<script src="/assets/js/runtime~main.417c5b9c.js"></script>
<script src="/assets/js/main.9a597f30.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N4969FH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>